  <h2>工程ごとの機屋一覧</h2>

    <style>
        /* クラスに応じたスタイルを設定 */
      g.bar-wrapper.class-a rect.bar-progress {
        fill: #3498db !important; /* 青 */
      }

      g.bar-wrapper.class-b rect.bar-progress {
        fill: #2ecc71 !important; /* 緑 */
      }
    </style>

  <div class='gantt-wrap flex min-w-[800px]'>
    <table class="flex-none w-1/3 border border-gray-300 table-auto">
      <thead>
        <tr>
          <th>品番</th>
          <th>企業</th>
          <th>織機</th>
          <th>ステータス</th>
        </tr>
      </thead>
      <tbody>
        <% JSON.parse(@orders).each do |order| %>

          <tr>
            <td><%= order["product_number"] %></td>
            <td><%= order["company"] %></td>
            <td><%= order["machine"] %></td>
            <td><%= order["work_process_status"] %></td>
          </tr>
        <% end %>
      </tbody>
    </table>

    <svg id="gantt" class="flex-grow w-3/4"></svg>
  </div>

  <script>
    window.onload = function () {
      const orders = <%= raw @orders %>
        console.log(orders)

      const gantt = new Gantt("#gantt", orders, {
        view_mode: 'Month'
      });

      //
      // 横軸の月ラベルを日本語に変更
      setTimeout(function () {
        console.log('timeout proc');
        const labels = document.querySelectorAll(".lower-text");
        const monthMapping = {
          "January": "1月",
          "February": "2月",
          "March": "3月",
          "April": "4月",
          "May": "5月",
          "June": "6月",
          "July": "7月",
          "August": "8月",
          "September": "9月",
          "October": "10月",
          "November": "11月",
          "December": "12月",
        };

        labels.forEach((label) => {
          const text = label.textContent.trim();
          if (monthMapping[text]) {
            label.textContent = monthMapping[text];
          }
        });
      }, 500); // 描画が完了するまで待機

      const popups = document.querySelectorAll(".bar-wrapper");
      // popups.addEventListener("click", setPopup);

      // popup内の月ラベルを日本語に変更
      popups.forEach((popup) => {
        popup.addEventListener("click", function () {
          setTimeout(replacePopupDate, 100);
        });
      });

      function replacePopupDate() {
        console.log('timeout proc2');
        const popupSubtitles = document.querySelectorAll(".subtitle");
        console.log(popupSubtitles);
        const monthMapping = {
          "January": "1 /",
          "February": "2 /",
          "March": "3 /",
          "April": "4/",
          "May": "5/",
          "June": "6/",
          "July": "7/",
          "August": "8/",
          "September": "9/",
          "October": "10 /",
          "November": "11 /",
          "December": "12 /",
        };

        popupSubtitles.forEach((subtitle) => {
          let text = subtitle.textContent.trim(); // テキスト内容を取得
          console.log("Before Translation:", text);

          // 月名を日本語に置き換える
          for (const [english, japanese] of Object.entries(monthMapping)) {
            text = text.replace(new RegExp(english, "g"), japanese); // すべての一致箇所を置換
          }

          subtitle.textContent = text; // 翻訳後のテキストを設定
          console.log("After Translation:", subtitle.textContent);
        });
      }
    }
  </script>
